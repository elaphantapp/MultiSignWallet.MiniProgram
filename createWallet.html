<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script src="https://cdn.bootcss.com/lodash.js/4.17.12-pre/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script src="./js/vue-clipboard.min.js"></script>
</head>
<style type="text/css">
    .fl {
        float: left;
    }
    
    .fr {
        float: right;
    }
    
    html,
    body,
    div,
    span,
    applet,
    object,
    iframe,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    blockquote,
    pre,
    a,
    abbr,
    acronym,
    address,
    big,
    cite,
    code,
    del,
    dfn,
    em,
    img,
    ins,
    kbd,
    q,
    s,
    samp,
    small,
    strike,
    strong,
    sub,
    sup,
    tt,
    var,
    b,
    u,
    i,
    center,
    dl,
    dt,
    dd,
    ol,
    ul,
    li,
    fieldset,
    form,
    label,
    legend,
    table,
    caption,
    tbody,
    tfoot,
    thead,
    tr,
    th,
    td,
    article,
    aside,
    canvas,
    details,
    embed,
    figure,
    figcaption,
    footer,
    header,
    hgroup,
    menu,
    nav,
    output,
    ruby,
    section,
    summary,
    time,
    mark,
    audio,
    video {
        margin: 0;
        padding: 0;
        border: 0;
        font-size: 100%;
        font: inherit;
        vertical-align: baseline;
    }
    /* HTML5 display-role reset for older browsers */
    
    article,
    aside,
    details,
    figcaption,
    figure,
    footer,
    header,
    hgroup,
    menu,
    nav,
    section {
        display: block;
    }
    
    body {
        line-height: 1;
        background: #f0eff5;
    }
    
    ol,
    ul {
        list-style: none;
    }
    
    blockquote,
    q {
        quotes: none;
    }
    
    blockquote:before,
    blockquote:after,
    q:before,
    q:after {
        content: '';
        content: none;
    }
    
    table {
        border-collapse: collapse;
        border-spacing: 0;
    }
    /* add */
    
    body {
        font-size: 12px;
        margin: 0;
        padding: 0;
        font-family: Arial, "微软雅黑";
    }
    
    body,
    html {
        height: 100%;
    }
    
    img {
        border: 0
    }
    
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        font-size: 100%;
        font-weight: normal;
    }
    
    select,
    input {
        vertical-align: middle
    }
    
    .clear {
        display: block !important;
        clear: both !important;
        float: none !important;
        margin: 0 !important;
        padding: 0 !important;
        height: 0;
        line-height: 0;
        font-size: 0;
        overflow: hidden;
    }
    
    .clearfix {
        zoom: 1;
    }
    
    .clearfix:after {
        content: "";
        display: block;
        clear: both;
        height: 0;
    }
    
    .spacer {
        clear: both;
        font-size: 0;
        height: 0;
        line-height: 0;
    }
    
    a {
        color: #333;
        text-decoration: none
    }
    
    a:hover {
        color: #f00;
    }
    
    img,
    input,
    label {
        vertical-align: middle;
    }
    
    body {
        background: #E5E5E5;
    }
    
    #app {
        position: relative;
        padding: 15px 10px;
    }
    
    .left {
        width: 80%;
        height: 48px;
        line-height: 48px;
        background: #FFFFFF;
        box-shadow: 0px 2px 10px rgba(106, 147, 205, 0.1);
        border-radius: 5px;
    }
    
    .left span {
        font-family: Bio Sans;
        font-size: 20px;
        color: #0070C8;
    }
    
    .left .tr {
        padding: 0px;
        margin: 0px;
        width: 100%;
        resize: none;
        border: 0;
        vertical-align: middle;
        outline: none;
        box-shadow: 0px 2px 10px rgba(106, 147, 205, 0.1);
        border-radius: 5px;
        height: 48px;
    }
    
    .left .tr::-webkit-input-placeholder {
        height: 48px;
        line-height: 48px;
    }
    /* 使用webkit内核的浏览器 */
    
    .left .tr:-moz-placeholder {
        height: 48px;
        line-height: 48px;
    }
    /* Firefox版本4-18 */
    
    .left .tr::-moz-placeholder {
        height: 48px;
        line-height: 48px;
    }
    /* Firefox版本19+ */
    
    .left .tr:-ms-input-placeholder {
        height: 48px;
        line-height: 48px;
    }
    
    .right {
        width: 20%;
        height: 48px;
        line-height: 48px;
        text-align: center;
    }
    
    .right span {
        font-family: Bio Sans;
        font-size: 14px;
        text-align: center;
        color: #0070C8;
        border: 1px solid #0070C8;
        box-sizing: border-box;
        border-radius: 20px;
        padding: 5px 10px;
    }
    
    .del {
        position: relative;
    }
    
    .del .jianhao {
        color: #FF3365;
        width: 10px;
        height: 2px;
    }
    
    .add {
        position: relative;
    }
    
    .three {
        position: relative;
        margin-top: 64px;
        height: 92px;
        background: #FFFFFF;
        box-shadow: 0px 2px 10px rgba(106, 147, 205, 0.1);
        border-radius: 5px;
    }
    
    .three .one {
        margin: 0px 15px;
        height: 46px;
        line-height: 46px;
        border-bottom: 1px solid #CCCCCC;
    }
    
    .three .second {
        margin: 0px 15px;
        height: 46px;
        line-height: 46px;
    }
    
    .three .second .jishu {
        text-align: center;
        width: 86px;
        height: 32px;
        line-height: 32px;
        border: 1px solid #DEDEE0;
        box-sizing: border-box;
        border-radius: 100px;
        margin-top: 8px;
    }
    
    .four {
        width: 220px;
        margin: 0 auto;
        text-align: center;
    }
    
    .four p {
        font-family: Bio Sans;
        font-size: 16px;
        margin-top: 26px;
        width: 220px;
        line-height: 44px;
        height: 44px;
        background: #0070C8;
        border-radius: 200px;
        color: #FFFFFF;
        cursor: pointer;
    }
    
    .walletname {
        position: relative;
        width: 100%;
        margin: 10px 0px;
    }
    
    .walletname input {
        -moz-box-sizing: border-box;
        /*Firefox3.5+*/
        -webkit-box-sizing: border-box;
        /*Safari3.2+*/
        -o-box-sizing: border-box;
        /*Opera9.6*/
        -ms-box-sizing: border-box;
        /*IE8*/
        box-sizing: border-box;
        width: 100%;
        padding: 10px 0px;
        padding-left: 10px;
        margin: 0;
        resize: none;
        border: 0;
        vertical-align: middle;
        outline: none;
        box-shadow: 0px 2px 10px rgba(106, 147, 205, 0.1);
        border-radius: 5px;
    }
    
    .toast {
        position: fixed;
        z-index: 2000;
        left: 50%;
        top: 25%;
        transition: all .5s;
        -webkit-transform: translateX(-50%) translateY(-50%);
        -moz-transform: translateX(-50%) translateY(-50%);
        -ms-transform: translateX(-50%) translateY(-50%);
        -o-transform: translateX(-50%) translateY(-50%);
        transform: translateX(-50%) translateY(-50%);
        text-align: center;
        border-radius: 5px;
        color: #FFF;
        background: rgba(17, 17, 17, 0.7);
        height: 45px;
        line-height: 45px;
        padding: 0 15px;
        width: 200px;
    }
    
    .dialog {
        position: fixed;
        width: 100%;
        height: 100%;
        left: 0px;
        top: 0px;
        z-index: 999;
    }
    
    .arrow_mask {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        z-index: 998;
        display: block;
        background: black;
        opacity: 0.3;
        box-shadow: 0px 4px 10px rgba(95, 111, 237, 0.2);
    }
    
    .kuang {
        position: absolute;
        width: 300px;
        height: 160px;
        left: 50%;
        top: 50%;
        margin-left: -150px;
        margin-top: -80px;
        background: #FFFFFF;
        box-shadow: 0px 2px 10px rgba(106, 147, 205, 0.1);
        border-radius: 5px;
        z-index: 999;
    }
    
    .kuang .title {
        margin-top: 10px;
        text-align: center;
        font-size: 18px;
    }
    
    .kuang .content {
        padding: 10px;
        height: 65px;
        overflow: auto;
        line-height: 25px;
        font-size: 16px;
        word-wrap: break-word;
        word-break: normal;
        white-space: normal;
    }
    
    .kuang .footer {
        position: relative;
    }
    
    .kuang .footer .left-btn {
        position: absolute;
        width: 120px;
        height: 40px;
        left: 10px;
        line-height: 40px;
        text-align: center;
        border-radius: 5px;
        font-size: 16px;
        display: inline-block;
        background-color: #0070C8;
        color: #ffffff;
    }
    
    .kuang .footer .right-btn {
        position: absolute;
        width: 120px;
        height: 40px;
        right: 10px;
        line-height: 40px;
        text-align: center;
        border-radius: 5px;
        font-size: 16px;
        display: inline-block;
        background-color: #0070C8;
        color: #ffffff;
    }
    
    [v-cloak] {
        display: none;
    }
</style>

<body>
    <div id="app" v-cloak>
        <div class="toast" v-show="toastShow">
            {{toastText}}
        </div>
        <div class="dialog" v-if="showMask">
            <div class="arrow_mask" v-on:click="click_close"></div>
            <div class="kuang">
                <div class="title">{{curLangule["key39"]}}</div>
                <div class="content">{{curLangule["key40"]}}</div>
                <div class="footer">
                    <span class="right-btn" v-on:click="shengcheng1()">{{curLangule["key38"]}}</span>
                    <span class="left-btn" v-on:click="shengcheng()">{{curLangule["key37"]}}</span>
                </div>
            </div>
        </div>
        <div class="walletname">
            <input v-model="walletName" :placeholder="curLangule['error0']" />
        </div>
        <div class="list">
            <div class="del" v-for="(item,index) in publickeyArr">
                <div class="left fl">
                    <div class="fl" style="width:10%;height:48px;text-align: center;cursor: pointer;" v-on:click='del(item)'>
                        <span class="jianhao">-</span>
                    </div>
                    <div class="fl" style="width:90%;height:48px;line-height: 48px">
                        <textarea class="tr" :placeholder="curLangule['key6']" v-model="publickeyArr[index]">
                                        </textarea>
                    </div>
                </div>
                <div class="right fr" v-on:click="doCopy(item)" style="cursor: pointer;">
                    <span>{{curLangule["key5"]}}</span>
                </div>
                <div style="padding-bottom:2px">&nbsp;</div>
            </div>
        </div>

        <div class="add">
            <div class="left fl">
                <div class="fl" style="width:10%;height:48px;text-align: center;;cursor: pointer;" v-on:click="add">
                    <span>+</span>
                </div>
                <div class="fl" style="width:90%;height:48px;line-height: 48px">
                    <textarea class="tr" :placeholder="curLangule['key6']" v-model="spublic">
                            </textarea>
                </div>
            </div>
            <div class="right fr" v-on:click="doCopy(spublic)" style="cursor: pointer;">
                <span>{{curLangule["key5"]}}</span>
            </div>
        </div>

        <div class="three">
            <div class="one">
                <div class="fl"><span style="font-family: Bio Sans;
                    font-size: 16px;
                    color: #222222;">{{curLangule["key7"]}}</span></div>
                <div class="fr"><span style="font-family: Bio Sans;font-size: 16px;
                    text-align: right;
                    color: #222222;">{{publickeyArr.length}}</span></div>
            </div>
            <div class="clearfix"></div>
            <div class="second">
                <div class="fl" style="text-align:left"> <span style="font-family: Bio Sans;
                    font-size: 14px;color: #000000;">{{curLangule["key8"]}}</span>
                </div>
                <div class="fr">
                    <div class="jishu">
                        <span style="width: 20px;
                        display:inline-block;text-align: center;font-size: 18px;color: #888888;cursor: pointer;" v-on:click="jianhao">-</span>
                        <span style="width:1px;
                            display:inline-block;text-align: center;font-size: 18px;color: #DEDEE0;">|</span>
                        <span style="width: 20px;
                            display:inline-block;text-align: center;font-size: 18px;color: #0070C8;">{{schemeConfig['RequiredCount']}}</span>
                        <span style="width:1px;
                            display:inline-block;text-align: center;font-size: 18px;color: #DEDEE0;">|</span>
                        <span style="width: 20px;
                            display:inline-block;text-align: center;font-size: 18px;color: #888888;cursor: pointer;" v-on:click="jiahao">+</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="four" v-on:click="createWallet">
            <p>{{curLangule["key9"]}}</p>
        </div>

        <div class="four" v-on:click="shengcheng()">
            <p style="margin-top: 20px;">{{curLangule["key34"]}}</p>
        </div>

        <div class="four" v-on:click="shengcheng1()">
            <p style="margin-top: 20px;">{{curLangule["key35"]}}</p>
        </div>

        <div class="four" v-on:click="back()">
            <p style="margin-top: 20px;">{{curLangule["key36"]}}</p>
        </div>

    </div>
</body>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            loading: true,
            zh: {
                title: "创建一个钱包",
                key5: '复制',
                key6: '添加公钥',
                key7: '公钥总数:',
                key8: '转账必需批准数:',
                key9: '创建',
                key29: '复制成功',
                key34: '复制给参与人',
                key35: '复制完成的url',
                error0: '请输入钱包名字',
                error1: '请输入公钥',
                error2: '公钥已存在',
                error3: '钱包名字已存在',
                error4: '钱包名字不能超过30字符',
                error5: '公钥重复',
                key36: "返回",
                key37: '分享',
                key38: '完成',
                key39: "确认框",
                key40: "继续分享",
            },
            en: {
                title: "Create a Wallet",
                key5: 'copy',
                key6: 'Add public key',
                key7: 'Total public keys:',
                key8: 'Min.required for Approval:',
                key9: 'Create',
                key29: 'Copy Success',
                key34: 'Copy to participants',
                key35: 'Duplicated URL',
                error0: 'Please enter the name of your wallet',
                error1: 'Please enter public key.',
                error2: 'The public key already exists',
                error3: 'The wallet name already exists',
                error4: "Wallet name can't be more than 30 characters",
                error5: 'The public key Repeat',
                key36: "Back",
                key37: 'Share',
                key38: 'Complete',
                key39: "Confirm",
                key40: "Continue to share",
            },
            curLangule: {},
            schemeConfig: {
                "AppID": "f4d54cd97afa828a9705e38eb679fad564cf3adf4cecd1a5503498155969b07baaa4c4a016084c0f21e06c59e76c33929925052d7d0ae3cfc679a0fdf48ec23f",
                "AppName": encodeURIComponent("ELA Multi-sig Wallet"),
                "DID": "ipFFpL1JwPRQKfhmxak8r1wWEbdkJ3rXZu",
                "PublicKey": "035731ff69f8cfdcd9881e573143d71de2390b2e8e71fa14729e6b506f5d74939d",
                "PublicKeys": "",
                "RequiredCount": 2,
                "ReturnUrl": "",
            },
            schemeConfig1: {
                "AppID": "f4d54cd97afa828a9705e38eb679fad564cf3adf4cecd1a5503498155969b07baaa4c4a016084c0f21e06c59e76c33929925052d7d0ae3cfc679a0fdf48ec23f",
                "AppName": encodeURIComponent("ELA Multi-sig Wallet"),
                "DID": "ipFFpL1JwPRQKfhmxak8r1wWEbdkJ3rXZu",
                "PublicKey": "035731ff69f8cfdcd9881e573143d71de2390b2e8e71fa14729e6b506f5d74939d",
                "RandomNumber": "123456789",
                "ReturnUrl": "",
            },
            curLanguleKey: 'zh',
            publickeyArr: [],
            walletName: "",
            spublic: '',
            toastShow: false,
            toastText: '',
            walletList: {},
            showMask: false,
        },
        methods: {
            click_close() {
                this.showMask = false;
            },
            back() {
                location.href = './index.html';
            },
            shengcheng1() {
                turl = "https://multisignwallet.elaphant.app/createWallet.html?publicArr=" + JSON.stringify(this.publickeyArr);
                this.doCopy(turl);
                this.showMask = false;
            },
            shengcheng() {
                var url = this.buildIdentity();
                var turl = 'https://launch.elaphant.app?appName=ELA Multi-sig Wallet&autoRedirect=True&appTitle=ELA Multi-sig Wallet&redirectURL=' + encodeURIComponent(url);
                this.doCopy(turl);
                this.showMask = false;
                //location.href = turl;
            },
            getLen2(str) {　　　　 //将中文替换成两个英文字符来统计
                return str.replace(/[^\x00-\xff]/g, "aa").length;
            },
            getLanugle: function() {
                this.curLangule = this.en;
                this.curLanguleKey = 'en';
                var JsSrc = (navigator.language || navigator.browserLanguage).toLowerCase();
                if (JsSrc.indexOf('zh') >= 0) {
                    // 假如浏览器语言是中文
                    this.curLanguleKey = 'zh';
                    this.curLangule = this.zh;
                } else if (JsSrc.indexOf('en') >= 0) {
                    this.curLangule = this.en;
                    this.curLanguleKey = 'en';
                } else {
                    // 假如浏览器语言是其它语言
                    this.curLangule = this.en;
                    this.curLanguleKey = 'en';
                }
            },
            createWallet() {
                if (this.checkParms()) {
                    var publicKeys = this.publickeyArr.join(",");
                    var extraParm = 'name=' + this.walletName + '&' + 'requiredCount=' + this.schemeConfig['RequiredCount'] + '&' + 'PublicKeys=' + publicKeys;
                    this.schemeConfig['ReturnUrl'] = 'https://multisignwallet.elaphant.app/walletDetails.html?' + extraParm;
                    var url = this.buildMultiCreate();
                    var turl = 'https://launch.elaphant.app?appName=ELA Multi-sig Wallet&autoRedirect=True&appTitle=ELA Multi-sig Wallet&redirectURL=' + encodeURIComponent(url);
                    location.href = turl;
                    this.showMask = false;
                    //location.href = 'walletDetails.html?' + 'name=' + this.walletName + '&' + 'requiredCount=' + this.schemeConfig['RequiredCount'] + '&' + 'PublicKeys=' + publicKeys + '&' + 'Address=' + '8ZCY9ksW4bxz7FCYARkXYCGmgkzABTSvwB';
                }
            },
            buildMultiCreate() {
                var url = "elaphant://multicreate?";
                var that = this;
                _.forEach(this.schemeConfig, function(val, key, index) {
                    if (key === 'ReturnUrl') {
                        val = encodeURIComponent(val);
                    } else if (key === 'PublicKeys') {
                        val = encodeURIComponent(that.publickeyArr.join(","));
                    }
                    if (key === 'ReturnUrl') {
                        url += key + '=' + val;
                    } else {
                        url += key + '=' + val + '&';
                    }

                });

                return url;
            },
            del(publickey) {
                var index = this.publickeyArr.indexOf(publickey);
                this.publickeyArr.splice(index, 1);
                if (this.publickeyArr.length > 2) {
                    this.schemeConfig['RequiredCount'] = this.publickeyArr.length - 1;
                } else {
                    this.schemeConfig['RequiredCount'] = 2;
                }
            },
            doCopy(publickey) {
                var v = this;
                this.$copyText(publickey).then(function(e) {
                    v.toast(v.curLangule['key29']);
                }, function(e) {})
            },
            add() {
                if (this.spublic === "") {
                    this.toast(this.curLangule['error1']);
                    return;
                }
                if (this.publickeyArr.indexOf(this.spublic) > -1) {
                    this.toast(this.curLangule['error2']);
                    return;
                }

                this.publickeyArr.push(this.spublic);
                if (this.publickeyArr.length > 2) {
                    this.schemeConfig['RequiredCount'] = this.publickeyArr.length - 1;
                } else {
                    this.schemeConfig['RequiredCount'] = 2;
                }
                this.spublic = "";


            },
            jianhao() {
                if (this.schemeConfig['RequiredCount'] === 2) {
                    this.schemeConfig['RequiredCount'] = 2;
                } else {
                    this.schemeConfig['RequiredCount'] = this.schemeConfig['RequiredCount'] - 1;
                }
            },
            jiahao() {
                if (this.publickeyArr.length == 0) {
                    this.schemeConfig['RequiredCount'] = 2;
                    return;
                }
                if (this.schemeConfig['RequiredCount'] === this.publickeyArr.length) {
                    this.schemeConfig['RequiredCount'] = this.publickeyArr.length;
                } else {
                    this.schemeConfig['RequiredCount'] = this.schemeConfig['RequiredCount'] + 1;
                }
            },
            toast(str) {
                var v = this;
                v.toastText = str
                v.toastShow = true
                setTimeout(function() {
                    v.toastShow = false
                }, 1500)
            },
            checkParms() {
                if (this.walletName === "") {
                    this.toast(this.curLangule['error0']);
                    return false;
                }

                if (this.getLen2(this.walletName) > 30) {
                    this.toast(this.curLangule['error4']);
                    return false;
                }

                // if (this.isExitWalletName(this.walletName)) {
                //     this.toast(this.curLangule['error3']);
                //     return false;
                // }
                if (this.publickeyArr.indexOf("") > -1) {
                    this.toast(this.curLangule['key6']);
                    return false;
                }

                if (this.isRepeat(this.publickeyArr)) {
                    this.toast(this.curLangule['error5']);
                    return false;
                }

                if (this.publickeyArr.length < 2) {
                    this.toast(this.curLangule['key6']);
                    return false;
                }

                return true;
            },
            isRepeat(arr) {

                var hash = {};

                for (var i in arr) {

                    if (hash[arr[i]])

                        return true;

                    hash[arr[i]] = true;

                }

                return false;

            },
            isExitWalletName(name) {
                var isName = false;
                if (this.walletList != "") {
                    var list = JSON.parse(this.walletList);
                    _.forEach(list, function(val, key, index) {
                        if (val['name'] === name) {
                            isName = true;
                        }
                    });
                }
                return isName;
            },
            getUrlParam: function(name) {
                //正则表达式过滤
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                //正则规则
                var r = window.location.search.substr(1).match(reg);

                if (r != null) return decodeURI(r[2]);
                return null;
            },
            buildIdentity() {
                this.schemeConfig1['ReturnUrl'] = 'https://multisignwallet.elaphant.app/createWallet.html?publicArr=' + JSON.stringify(this.publickeyArr);
                var url = "elaphant://identity?";
                _.forEach(this.schemeConfig1, function(val, key, index) {
                    if (key === 'ReturnUrl') {
                        val = encodeURIComponent(val);
                    }
                    url += key + '=' + val + '&';
                });

                return url.substring(0, url.length - 1);
            },
        },
        created: function() {

        },
        mounted() {
            var publicStr = this.getUrlParam("publicArr") || "";
            if (publicStr != "") {
                this.publickeyArr = JSON.parse(publicStr);
            } else {
                this.publickeyArr = [];
            }
            var item = this.getUrlParam("Data") || "";
            if (item != "") {
                var mdata = decodeURIComponent(item);
                var json = JSON.parse(mdata);
                var publicKey = json.PublicKey;
                this.publickeyArr.push(publicKey);
            }
            if (this.publickeyArr.length > 2) {
                this.schemeConfig['RequiredCount'] = this.publickeyArr.length - 1;
            } else {
                this.schemeConfig['RequiredCount'] = 2;
            }
            this.getLanugle();
            document.title = this.curLangule["title"];

            //this.showMask = true;
        }
    });
</script>

</html>